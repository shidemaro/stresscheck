<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #d8f3dc;
      color: #333;
      margin: 0;
      padding: 20px;
    }
    header, footer {
      background-color: #95d5b2;
      color: white;
      text-align: center;
      padding: 10px 0;
    }
    main {
      max-width: 800px;
      margin: auto;
    }
    .question {
      margin-bottom: 15px;
    }
    .options label {
      margin-right: 15px;
    }
    .submit-button {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .results {const passwordPattern = /^(?=(?:.*\d){4,})(?=(?:.*[a-zA-Z]){4,}).{8,}$/;
if (!isAdmin && !passwordPattern.test(password)) {
  alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯æ•°å­—4æ–‡å­—ä»¥ä¸Šãƒ»è‹±å­—4æ–‡å­—ä»¥ä¸Šã‚’å«ã¿ã€åˆè¨ˆ8æ–‡å­—ä»¥ä¸Šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚");
  return;
}
      margin-top: 30px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header>
    <h1>ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯</h1>
    <div style="text-align:center; margin: 10px 0;">
      <img src="/mnt/data/ChatGPT Image 2025å¹´5æœˆ11æ—¥ 23_34_15.png" alt="ã‹ã‚ã„ã„ç¾Š" width="120">
    </div>
  </header>

  <main>
    <section id="intro">
      <p>ç°¡å˜ãªã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ã§ãã¾ã™ã€‚</p>
      <form id="login-form">
        <input type="text" id="company" placeholder="ä¼šç¤¾å" required>
        <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" required>
        <input type="text" id="username" placeholder="æ°åï¼ˆå€‹äººç”¨ã®ã¿ï¼‰">
        <label for="birthdate">ç”Ÿå¹´æœˆæ—¥ï¼š</label>
        <input type="date" id="birthdate" required>
        <label><input type="checkbox" id="adminCheck"> ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</label><br>
        <button type="submit">ãƒ­ã‚°ã‚¤ãƒ³</button>
      </form>
    </section>

    <section id="checklist" style="display:none;">
      <form id="stressForm">
        <h2>A. ä»•äº‹ã«ã¤ã„ã¦</h2>
        <div id="sectionA"></div>

        <h2>B. æœ€è¿‘ã®çŠ¶æ…‹</h2>
        <div id="sectionB"></div>

        <h2>C. å‘¨å›²ã¨ã®é–¢ä¿‚</h2>
        <div id="sectionC"></div>

        <h2>D. æº€è¶³åº¦ã«ã¤ã„ã¦</h2>
        <div id="sectionD"></div>

        <button type="submit" class="submit-button">é€ä¿¡</button>
      </form>
      <div id="result" class="results"></div>
      <button id="downloadPDF" class="submit-button">PDFã¨ã—ã¦ä¿å­˜</button>
    </section>

    <section id="adminPanel" style="display:none;">
      <h2>ç®¡ç†ç”»é¢</h2>
      <div id="adminResults"></div>
      <button id="exportCSV" class="submit-button">CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
    <div style="text-align:center; margin-bottom: 20px;">
  <img src="https://cdn.openai.com/chatgpt/sheep-cute-1.png" alt="ã‹ã‚ã„ã„ã²ã¤ã˜" width="120">
</div>
<div style="text-align:center; margin-bottom:10px;">
  <label>å¹´åº¦è¡¨ç¤ºåˆ‡æ›¿ï¼š
    <select id="filterSelect">
      <option value="fiscal">ä»Šå¹´åº¦</option>
      <option value="all">ã™ã¹ã¦</option>
    </select>
  </label>
</div>
$1
  <label>è¡¨ç¤ºåˆ‡æ›¿ï¼š
    <select id="filterSelect">
      <option value="fiscal">ä»Šå¹´åº¦</option>
      <option value="all">ã™ã¹ã¦</option>
    </select>
  </label>
</div>
</section>
<section id="adminMaster" style="display:none; margin: 20px;">
  <h2>ãƒã‚¹ã‚¿ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³</h2>
  <p>å…¨ä¼šç¤¾ã®å›ç­”ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
  <div id="masterResults"></div>
  <button id="exportAllCSV" class="submit-button">ã™ã¹ã¦CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
</section>
</main>

  <footer>
    <p>&copy; 2025 ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ </p>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js">document.getElementById('exportCSV').addEventListener('click', () => {
  const company = document.getElementById('company').value;
  let dataList = [];
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.startsWith(`stress_${company}_`)) {
    const item = JSON.parse(localStorage.getItem(key));
    const itemDate = new Date(item.timestamp);
    const current = new Date();
    const fiscalYearStart = new Date(current.getMonth() < 3 ? current.getFullYear() - 1 : current.getFullYear(), 3, 1);
    if (filter === 'fiscal' && itemDate < fiscalYearStart) continue;
      if (filter === 'all') {}
      dataList.push(item);
    }
  }

  // ä¸¦ã³æ›¿ãˆï¼ˆä¾‹ï¼šBåˆè¨ˆãŒé«˜ã„é †ï¼‰
  dataList.sort((a, b) => b.totalB - a.totalB);

  const rows = [["æ°å", "ä¼šç¤¾å", "Aåˆè¨ˆ", "Båˆè¨ˆ", "Cåˆè¨ˆ", "Dåˆè¨ˆ", "é¢è«‡å¸Œæœ›", "å›ç­”æ—¥æ™‚"]];
  for (const item of dataList) {
    const interview = item.interview === 'å¸Œæœ›ã™ã‚‹' ? 'å¸Œæœ›ã™ã‚‹' : '';
    rows.push([item.name || '', item.company || '', item.totalA, item.totalB, item.totalC, item.totalD, interview, item.timestamp]);
  }

  const csvContent = rows.map(r => r.join(",")).join("
");
  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${company}_stress_check.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
});
    if (key.startsWith(`stress_${company}_`)) {
      const item = JSON.parse(localStorage.getItem(key));
      const interview = item.interview === 'å¸Œæœ›ã™ã‚‹' ? 'å¸Œæœ›ã™ã‚‹' : '';
      rows.push([item.name || '', item.company || '', item.totalA, item.totalB, item.totalC, item.totalD, interview, item.timestamp]);
    }
  }
  const csvContent = rows.map(r => r.join(",")).join("
");
  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${company}_stress_check.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
});
function loadAllData() {
  const filter = document.getElementById("filterSelect")?.value || "fiscal";
  let html = "<table border='1' style='width:100%;border-collapse:collapse;'>" +
             "<tr><th>ä¼šç¤¾å</th><th>æ°å</th><th>Aåˆè¨ˆ</th><th>Båˆè¨ˆ</th><th>Cåˆè¨ˆ</th><th>Dåˆè¨ˆ</th><th>é¢è«‡å¸Œæœ›</th><th>å›ç­”æ—¥æ™‚</th></tr>";
  const rows = [["ä¼šç¤¾å", "æ°å", "Aåˆè¨ˆ", "Båˆè¨ˆ", "Cåˆè¨ˆ", "Dåˆè¨ˆ", "é¢è«‡å¸Œæœ›", "å›ç­”æ—¥æ™‚"]];
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.startsWith("stress_")) {
    const item = JSON.parse(localStorage.getItem(key));
    const itemDate = new Date(item.timestamp);
    const current = new Date();
    const fiscalYearStart = new Date(current.getMonth() < 3 ? current.getFullYear() - 1 : current.getFullYear(), 3, 1);
    if (itemDate < fiscalYearStart) continue;
      const interview = item.interview === 'å¸Œæœ›ã™ã‚‹' ? 'å¸Œæœ›ã™ã‚‹' : '';
      html += `<tr><td>${item.company}</td><td>${item.name}</td><td>${item.totalA}</td><td>${item.totalB}</td><td>${item.totalC}</td><td>${item.totalD}</td><td>${interview}</td><td>${item.timestamp}</td></tr>`;
      rows.push([item.company, item.name, item.totalA, item.totalB, item.totalC, item.totalD, interview, item.timestamp]);
    }
  }
  html += "</table>";
  document.getElementById("masterResults").innerHTML = html;

  document.getElementById("exportAllCSV").onclick = () => {
    const csv = rows.map(r => r.join(",")).join("
");
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `å…¨ä¼šç¤¾_ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯çµæœ.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  };
}
</script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const loginForm = document.getElementById('login-form');
      const checklist = document.getElementById('checklist');
      const adminPanel = document.getElementById('adminPanel');
      const stressForm = document.getElementById('stressForm');
      const resultDiv = document.getElementById('result');
      const sectionA = document.getElementById('sectionA');
      const sectionB = document.getElementById('sectionB');
      const sectionC = document.getElementById('sectionC');
      const sectionD = document.getElementById('sectionD');
      const adminResults = document.getElementById('adminResults');

      const A_questions = [
        "éå¸¸ã«ãŸãã•ã‚“ã®ä»•äº‹ã‚’ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„",
        "æ™‚é–“å†…ã«ä»•äº‹ãŒå‡¦ç†ã—ãã‚Œãªã„",
        "ä¸€ç”Ÿæ‡¸å‘½åƒã‹ãªã‘ã‚Œã°ãªã‚‰ãªã„",
        "ã‹ãªã‚Šæ³¨æ„ã‚’é›†ä¸­ã™ã‚‹å¿…è¦ãŒã‚ã‚‹",
        "é«˜åº¦ã®çŸ¥è­˜ã‚„æŠ€è¡“ãŒå¿…è¦ãªã‚€ãšã‹ã—ã„ä»•äº‹ã ",
        "å‹¤å‹™æ™‚é–“ä¸­ã¯ã„ã¤ã‚‚ä»•äº‹ã®ã“ã¨ã‚’è€ƒãˆã¦ã„ãªã‘ã‚Œã°ãªã‚‰ãªã„",
        "ã‹ã‚‰ã ã‚’å¤§å¤‰ã‚ˆãä½¿ã†ä»•äº‹ã ",
        "è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§ä»•äº‹ãŒã§ãã‚‹",
        "è‡ªåˆ†ã§ä»•äº‹ã®é †ç•ªãƒ»ã‚„ã‚Šæ–¹ã‚’æ±ºã‚ã‚‹ã“ã¨ãŒã§ãã‚‹",
        "è·å ´ã®ä»•äº‹ã®æ–¹é‡ã«è‡ªåˆ†ã®æ„è¦‹ã‚’åæ˜ ã§ãã‚‹",
        "è‡ªåˆ†ã®æŠ€èƒ½ã‚„çŸ¥è­˜ã‚’ä»•äº‹ã§ä½¿ã†ã“ã¨ãŒå°‘ãªã„",
        "ç§ã®éƒ¨ç½²å†…ã§æ„è¦‹ã®ãã„é•ã„ãŒã‚ã‚‹",
        "ç§ã®éƒ¨ç½²ã¨ä»–ã®éƒ¨ç½²ã¨ã¯ã†ã¾ãŒåˆã‚ãªã„",
        "ç§ã®è·å ´ã®é›°å›²æ°—ã¯å‹å¥½çš„ã§ã‚ã‚‹",
        "ç§ã®è·å ´ã®ä½œæ¥­ç’°å¢ƒï¼ˆé¨’éŸ³ã€ç…§æ˜ã€æ¸©åº¦ã€æ›æ°—ãªã©ï¼‰ã¯ã‚ˆããªã„",
        "ä»•äº‹ã®å†…å®¹ã¯è‡ªåˆ†ã«ã‚ã£ã¦ã„ã‚‹",
        "åƒããŒã„ã®ã‚ã‚‹ä»•äº‹ã "
      ];
      const B_questions = [
  "æ´»æ°—ãŒã‚ã„ã¦ãã‚‹",
  "å…ƒæ°—ãŒã„ã£ã±ã„ã ",
  "ç”Ÿãç”Ÿãã™ã‚‹",
  "æ€’ã‚Šã‚’æ„Ÿã˜ã‚‹",
  "å†…å¿ƒè…¹ç«‹ãŸã—ã„",
  "ã‚¤ãƒ©ã‚¤ãƒ©ã—ã¦ã„ã‚‹",
  "ã²ã©ãç–²ã‚ŒãŸ",
  "ã¸ã¨ã¸ã¨ã ",
  "ã ã‚‹ã„",
  "æ°—ãŒã¯ã‚Šã¤ã‚ã¦ã„ã‚‹",
  "ä¸å®‰ã ",
  "è½ç€ã‹ãªã„",
  "ã‚†ã†ã†ã¤ã ",
  "ä½•ã‚’ã™ã‚‹ã®ã‚‚é¢å€’ã ",
  "ç‰©äº‹ã«é›†ä¸­ã§ããªã„",
  "æ°—åˆ†ãŒæ™´ã‚Œãªã„",
  "ä»•äº‹ãŒæ‰‹ã«ã¤ã‹ãªã„",
  "æ‚²ã—ã„ã¨æ„Ÿã˜ã‚‹",
  "ã‚ã¾ã„ãŒã™ã‚‹",
  "ä½“ã®ãµã—ã¶ã—ãŒç—›ã‚€",
  "é ­ãŒé‡ã‹ã£ãŸã‚Šé ­ç—›ãŒã™ã‚‹",
  "é¦–ç­‹ã‚„è‚©ãŒã“ã‚‹",
  "è…°ãŒç—›ã„",
  "ç›®ãŒç–²ã‚Œã‚‹",
  "å‹•æ‚¸ã‚„æ¯åˆ‡ã‚ŒãŒã™ã‚‹",
  "èƒƒè…¸ã®å…·åˆãŒæ‚ªã„",
  "é£Ÿæ¬²ãŒãªã„",
  "ä¾¿ç§˜ã‚„ä¸‹ç—¢ã‚’ã™ã‚‹",
  "ã‚ˆãçœ ã‚Œãªã„"
];
      const C_questions = [
  "ä¸Šå¸ï¼ˆæ°—è»½ã«è©±ãŒã§ãã¾ã™ã‹ï¼‰",
  "è·å ´ã®åŒåƒšï¼ˆæ°—è»½ã«è©±ãŒã§ãã¾ã™ã‹ï¼‰",
  "é…å¶è€…ã€å®¶æ—ã€å‹äººç­‰ï¼ˆæ°—è»½ã«è©±ãŒã§ãã¾ã™ã‹ï¼‰",
  "ä¸Šå¸ï¼ˆå›°ã£ãŸæ™‚ã«é ¼ã‚Šã«ãªã‚Šã¾ã™ã‹ï¼‰",
  "è·å ´ã®åŒåƒšï¼ˆå›°ã£ãŸæ™‚ã«é ¼ã‚Šã«ãªã‚Šã¾ã™ã‹ï¼‰",
  "é…å¶è€…ã€å®¶æ—ã€å‹äººç­‰ï¼ˆå›°ã£ãŸæ™‚ã«é ¼ã‚Šã«ãªã‚Šã¾ã™ã‹ï¼‰",
  "ä¸Šå¸ï¼ˆå€‹äººçš„ãªå•é¡Œã‚’ç›¸è«‡ã—ãŸã‚‰ãã„ã¦ãã‚Œã¾ã™ã‹ï¼‰",
  "è·å ´ã®åŒåƒšï¼ˆå€‹äººçš„ãªå•é¡Œã‚’ç›¸è«‡ã—ãŸã‚‰ãã„ã¦ãã‚Œã¾ã™ã‹ï¼‰",
  "é…å¶è€…ã€å®¶æ—ã€å‹äººç­‰ï¼ˆå€‹äººçš„ãªå•é¡Œã‚’ç›¸è«‡ã—ãŸã‚‰ãã„ã¦ãã‚Œã¾ã™ã‹ï¼‰"
];
      const D_questions = ["ä»•äº‹ã«æº€è¶³ã ", "å®¶åº­ç”Ÿæ´»ã«æº€è¶³ã "];

      function renderQuestions(section, questions, prefix, labels) {
        section.innerHTML = '';
        questions.forEach((q, idx) => {
          const div = document.createElement('div');
          div.className = 'question';
          const qNum = idx + 1;
          div.innerHTML = `<p>${q}</p>` + labels.map((label, i) =>
            `<label><input type="radio" name="${prefix}${qNum}" value="${i+1}" required>${label}</label>`
          ).join(' ');
          section.appendChild(div);
        });
      }

      loginForm.addEventListener('submit', function(e) {
        if (company === 'master' && password === 'masterpass') {
          loginForm.style.display = 'none';
          document.getElementById('adminMaster').style.display = 'block';
          loadAllData();
          return;
        }
        const savedData = localStorage.getItem('autosave');
        if (savedData) {
          const confirmRestore = confirm('å‰å›ã®å›ç­”ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™ã€‚å¾©å…ƒã—ã¾ã™ã‹ï¼Ÿ');
          if (confirmRestore) {
            const answers = JSON.parse(savedData);
            Object.keys(answers).forEach(key => {
              const radio = document.querySelector(`input[name="${key}"][value="${answers[key]}"]`);
              if (radio) radio.checked = true;
            });
          } else {
            localStorage.removeItem('autosave');

            const record = {
              name: username,
              company: company,
              birthdate: birthdate,
              totalA, totalB, totalC, totalD,
              interview: formData.get('interview'),
              timestamp: new Date().toISOString()
            };
            const key = `stress_${company}_${username}_${birthdate}_${year}_${Date.now()}`;
            localStorage.setItem(key, JSON.stringify(record));

            resultDiv.innerHTML += `<p style='margin-top:1em;'>ğŸ‘ ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚ã”å›ç­”ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚<br><em>ã¤ã‚‰ã„ã¨ãã¯ã€èª°ã‹ã«è©±ã™ã ã‘ã§ã‚‚å¿ƒãŒå°‘ã—è»½ããªã‚Šã¾ã™ã€‚</em></p>`;
          }
        }
        e.preventDefault();
        const company = document.getElementById('company').value.trim();
        const password = document.getElementById('password').value.trim();
        const username = document.getElementById('username').value.trim();
        const isAdmin = document.getElementById('adminCheck').checked;

        const passwordPattern = /^(?=(?:.*\d){4,})(?=(?:.*[a-zA-Z]){4,}).{8,}$/;
        if (!isAdmin && !passwordPattern.test(password)) {
          alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯æ•°å­—4æ–‡å­—ä»¥ä¸Šãƒ»è‹±å­—4æ–‡å­—ä»¥ä¸Šã‚’å«ã¿ã€åˆè¨ˆ8æ–‡å­—ä»¥ä¸Šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚");
          return;
        }
        if (!company) {
          alert("ä¼šç¤¾åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
          return;
        }
        if (!isAdmin && !username) {
          alert("æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
          return;
        }

        if (isAdmin) {
          const savedPass = localStorage.getItem("adminpass_" + company);
          if (!savedPass) {
            localStorage.setItem("adminpass_" + company, password);
            alert("ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ–°è¦ç™»éŒ²ã—ã¾ã—ãŸã€‚æ¬¡å›ã‹ã‚‰ã“ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™ã€‚");
            loginForm.style.display = 'none';
            adminPanel.style.display = 'block';
            loadAdminData(company);
            const count = Array.from({length: localStorage.length}, (_, i) => localStorage.key(i))
              .filter(key => key.startsWith(`stress_${company}_`)).length;
            const countDiv = document.createElement('div');
            countDiv.style.fontWeight = 'bold';
            countDiv.style.marginBottom = '10px';
            const interviewCount = Array.from({length: localStorage.length}, (_, i) => localStorage.key(i))
  .filter(key => key.startsWith(`stress_${company}_`))
  .map(key => JSON.parse(localStorage.getItem(key)))
  .filter(item => item.interview === 'å¸Œæœ›ã™ã‚‹').length;
countDiv.textContent = `æå‡ºæ¸ˆã¿äººæ•°: ${count}äººã€€ï¼ã€€é¢è«‡å¸Œæœ›è€…: ${interviewCount}äºº`;
            adminResults.prepend(countDiv);
          } else {
            alert("ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚");
            return;
          }
        } else {
          loginForm.style.display = 'none';
          checklist.style.display = 'block';
          renderQuestions(sectionA, A_questions, 'A', ['ãã†ã ', 'ã¾ã‚ãã†ã ', 'ã‚„ã‚„é•ã†', 'é•ã†']);
          renderQuestions(sectionB, B_questions, 'B', ['ã»ã¨ã‚“ã©ãªã‹ã£ãŸ', 'ã¨ãã©ãã‚ã£ãŸ', 'ã—ã°ã—ã°ã‚ã£ãŸ', 'ã»ã¨ã‚“ã©ã„ã¤ã‚‚ã‚ã£ãŸ']);
          renderQuestions(sectionC, C_questions, 'C', ['éå¸¸ã«', 'ã‹ãªã‚Š', 'å¤šå°‘', 'å…¨ããªã„']);
          renderQuestions(sectionD, D_questions, 'D', ['æº€è¶³', 'ã¾ã‚æº€è¶³', 'ã‚„ã‚„ä¸æº€è¶³', 'ä¸æº€è¶³']);
          stressForm.dataset.company = company;
          stressForm.dataset.username = username;

          // å›ç­”é€”ä¸­ã®è‡ªå‹•ä¿å­˜æ©Ÿèƒ½
          stressForm.addEventListener('change', () => {
            const formData = new FormData(stressForm);
            const answerData = {};
            for (let [key, value] of formData.entries()) {
              answerData[key] = value;
            }
            localStorage.setItem('autosave', JSON.stringify(answerData));
          });

          // ã‚¹ã‚³ã‚¢é€ä¿¡ã¨è©•ä¾¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
          stressForm.addEventListener('submit', function(e) {
            const birthdate = document.getElementById('birthdate')?.value;
            const company = stressForm.dataset.company;
            const username = stressForm.dataset.username;
            const year = new Date().getMonth() < 3 ? new Date().getFullYear() - 1 : new Date().getFullYear();
            const duplicateKeyPrefix = `stress_${company}_${username}_${birthdate}_${year}`;
            const existingKey = Object.keys(localStorage).reverse().find(k => k.startsWith(duplicateKeyPrefix));
            if (existingKey) {
              const overwrite = confirm("åŒä¸€æ°åãƒ»ç”Ÿå¹´æœˆæ—¥ã§ä»Šå¹´åº¦ã™ã§ã«æå‡ºã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸Šæ›¸ãã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿï¼ˆã¯ã„ï¼æ–°ã—ã„å†…å®¹ã§ä¸Šæ›¸ãï¼ã„ã„ãˆï¼éå»ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒï¼‰");
              if (!overwrite) return;
              localStorage.removeItem(existingKey);
            }

            e.preventDefault();
            const formData = new FormData(stressForm);
            let totalA = 0, totalB = 0, totalC = 0, totalD = 0;
            for (let [key, value] of formData.entries()) {
              const score = parseInt(value);
              const section = key.charAt(0);
              if (section === 'A') totalA += score;
              else if (section === 'B') totalB += score;
              else if (section === 'C') totalC += score;
              else if (section === 'D') totalD += score;
            }
            let evaluation = "";
            let highStressFlag = false;
            if (totalB >= 77) {
              evaluation += "<br><span style='color:red;'>[é«˜ã‚¹ãƒˆãƒ¬ã‚¹è©²å½“] Bé …ç›®ã®åˆè¨ˆãŒ77ç‚¹ä»¥ä¸Š</span>";
              highStressFlag = true;
            } else if ((totalA + totalC) >= 76 && totalB >= 63) {
              evaluation += "<br><span style='color:red;'>[é«˜ã‚¹ãƒˆãƒ¬ã‚¹è©²å½“] A+Cã®åˆè¨ˆãŒ76ç‚¹ä»¥ä¸Š ã‹ã¤ BãŒ63ç‚¹ä»¥ä¸Š</span>";
              highStressFlag = true;
            }

            let guidance = "";
            if (highStressFlag) {
              guidance = "<p style='color:darkred;'><strong>ã‚ãªãŸã¯é«˜ã‚¹ãƒˆãƒ¬ã‚¹ã®å¯èƒ½æ€§ãŒã‚ã‚‹ã¨åˆ¤æ–­ã•ã‚Œã¾ã—ãŸã€‚ç”£æ¥­åŒ»ã¨ã®é¢è«‡ã‚’ã”æ¡ˆå†…ã„ãŸã—ã¾ã™ã€‚é¢è«‡ã¯å¼·åˆ¶ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€å¸Œæœ›ã•ã‚Œã‚‹æ–¹ã¯ä¸‹è¨˜ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚</strong></p>" +
                         "<label><input type='checkbox' name='interview' value='å¸Œæœ›ã™ã‚‹'> é¢è«‡ã‚’å¸Œæœ›ã™ã‚‹</label>";
            }

            resultDiv.innerHTML =
              `Aé …ç›®åˆè¨ˆ: ${totalA}ç‚¹<br>Bé …ç›®åˆè¨ˆ: ${totalB}ç‚¹<br>Cé …ç›®åˆè¨ˆ: ${totalC}ç‚¹<br>Dé …ç›®åˆè¨ˆ: ${totalD}ç‚¹<br><br><strong>${evaluation}</strong><br>${guidance}`;

            localStorage.removeItem('autosave');
          });
        }
      });
    });
  
    function loadAdminData(company) {
  const filter = document.getElementById("filterSelect")?.value || "fiscal";
  let html = "<table border='1' style='width:100%;border-collapse:collapse;'>" +
             "<tr><th>æ°å</th><th>Aåˆè¨ˆ</th><th>Båˆè¨ˆ</th><th>Cåˆè¨ˆ</th><th>Dåˆè¨ˆ</th><th>é¢è«‡å¸Œæœ›</th><th>å›ç­”æ—¥æ™‚</th></tr>";
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.startsWith(`stress_${company}_`)) {
      const item = JSON.parse(localStorage.getItem(key));
      const itemDate = new Date(item.timestamp);
      const current = new Date();
      const fiscalYearStart = new Date(current.getMonth() < 3 ? current.getFullYear() - 1 : current.getFullYear(), 3, 1);
      if (filter === 'fiscal' && itemDate < fiscalYearStart) continue;
      const interview = item.interview === 'å¸Œæœ›ã™ã‚‹' ? 'å¸Œæœ›ã™ã‚‹' : '';
      html += `<tr><td>${item.name || ""}</td><td>${item.totalA}</td><td>${item.totalB}</td><td>${item.totalC}</td><td>${item.totalD}</td><td>${interview}</td><td>${item.timestamp}</td></tr>`;
    }
  }
  html += "</table>";
  document.getElementById("adminResults").innerHTML = html;

  // è¡¨ç¤ºã‚’å¤‰æ›´ã—ãŸæ™‚ã®æ›´æ–°å‡¦ç†ã‚’è¿½åŠ 
  const filterSelect = document.getElementById("filterSelect");
  if (filterSelect) {
    filterSelect.onchange = () => loadAdminData(company);
  }
}_`)) {
          const item = JSON.parse(localStorage.getItem(key));
          const interview = item.interview === 'å¸Œæœ›ã™ã‚‹' ? 'å¸Œæœ›ã™ã‚‹' : '';
          html += `<tr><td>${item.name || ""}</td><td>${item.totalA}</td><td>${item.totalB}</td><td>${item.totalC}</td><td>${item.totalD}</td><td>${interview}</td><td>${item.timestamp}</td></tr>`;
        }
      }
      html += "</table>";
      document.getElementById("adminResults").innerHTML = html;
    }
  </script>
</body>
</html>
