<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ストレスチェックで仕事や生活のストレスを評価。簡単な質問でメンタルヘルスをサポート。">
  <meta name="keywords" content="ストレスチェック, メンタルヘルス, 職場ストレス">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://resources.infolinks.com; frame-src 'self' https://*.infolinks.com;">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>ストレスチェック</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/stresscheck/styles.css?v=20250514">
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- Infolinksスクリプト -->
  <script type="text/javascript">
    var infolinks_pid = 3436126;
    var infolinks_wsid = 0;
  </script>
  <script type="text/javascript" src="//resources.infolinks.com/js/infolinks_main.js"></script>
  <style>
    #userSection { display: block !important; visibility: visible !important; }
  </style>
</head>
<body>
  <header>
    <h1>ストレスチェック</h1>
    <nav>
      <a href="/stresscheck/index.html">ホーム</a>
      <a href="/stresscheck/admin.html">管理画面</a>
      <a href="/stresscheck/howto.html">使い方</a>
      <a href="/stresscheck/about.html">このサイトについて</a>
      <a href="/stresscheck/faq.html">FAQ</a>
      <a href="/stresscheck/contact.html">お問い合わせ</a>
      <a href="/stresscheck/tips.html">ストレス管理のヒント</a>
      <a href="/stresscheck/privacy.html">プライバシーポリシー</a>
    </nav>
  </header>

  <main>
    <section id="userSection" style="display:block !important; visibility:visible !important;">
      <h2>ストレスチェックを始めよう</h2>
      <p>簡単な質問で、仕事や生活のストレスを評価できます。年度ごとに1回のみ提出可能です。</p>
      <div class="notice">注意：ストレスチェックは1年1度の提出です。提出済みの場合は修正が可能です。匿名IDを他人と共有しないでください。</div>
      <form id="login-form">
        <input type="text" id="anonymousId" placeholder="匿名ID（例：ABC_001）" required aria-label="匿名ID">
        <button type="submit" class="submit-button">開始</button>
      </form>
    </section>
  </main>

  <footer>
    <p>© 2025 ストレスチェックシステム | 運営：ストレスチェックチーム</p>
    <p>
      <a href="/stresscheck/index.html">ホーム</a> |
      <a href="/stresscheck/admin.html">管理画面</a> |
      <a href="/stresscheck/howto.html">使い方</a> |
      <a href="/stresscheck/about.html">このサイトについて</a> |
      <a href="/stresscheck/faq.html">FAQ</a> |
      <a href="/stresscheck/contact.html">お問い合わせ</a> |
      <a href="/stresscheck/tips.html">ストレス管理のヒント</a> |
      <a href="/stresscheck/privacy.html">プライバシーポリシー</a>
    </p>
  </footer>

  <script>
    // パスワードハッシュ化関数
    async function hashPassword(password) {
      const msgBuffer = new TextEncoder().encode(password);
      const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    document.addEventListener('DOMContentLoaded', () => {
      console.log('ページロード開始: index.html');
      const loginForm = document.getElementById('login-form');
      const userSection = document.getElementById('userSection');

      // ホーム画面確認
      userSection.style.display = 'block';
      userSection.style.visibility = 'visible';
      console.log('userSection表示: display=block, visibility=visible');

      loginForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        console.log('ログイン処理開始');
        try {
          const anonymousIdInput = document.getElementById('anonymousId').value.trim();

          if (anonymousIdInput === 'master' && anonymousIdInput === 'sakaue0000m') {
            console.log('マスターログイン（パスワード一覧）');
            window.location.href = 'masterPasswordPanel.html';
            return;
          }

          if (anonymousIdInput === 'master' && anonymousIdInput === 'masterpass') {
            console.log('マスターログイン（全データ）');
            window.location.href = 'adminMaster.html';
            return;
          }

          if (!anonymousIdInput || !anonymousIdInput.match(/^[A-Za-z0-9]+_\d{3}$/)) {
            alert('正しい匿名IDを入力してください（例：ABC_001）。');
            return;
          }

          // 匿名IDをlocalStorageに保存
          localStorage.setItem('anonymousId', anonymousIdInput);
          localStorage.setItem('companyCode', anonymousIdInput.split('_')[0]);
          localStorage.setItem('currentYear', new Date().getFullYear());

          // 質問ページへ遷移
          window.location.href = 'checklist.html';
          console.log('ログイン成功: checklist.htmlへ遷移');
        } catch (error) {
          console.error('ログインエラー:', error);
          alert('ログインに失敗しました。匿名IDを確認してください。');
        }
      });
    });
  </script>
</body>
</html>
